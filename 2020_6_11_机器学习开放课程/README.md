```
机器学习开放课程：https://www.shiyanlou.com/courses/1283/learning/
```

### 实验一、使用Pandas进行数据探索

```
介绍：
	本次实验通过分析电信运营商的客户离网率数据集来熟悉Pandas数据探索的常用方法，并构建一个预测客户离网率的简单模型！

知识点：
	排列/索引/交叉表/透视表/数据探索
```

> Pandas的主要方法

```
Pandas是居于Numpy的一种工具，提供了大量数据探索的方法。Pandas可以使用类似SQL的方式对.csv/.tsv/.xlsx等格式的数据进行处理分析

Pandas主要使用的数据结构是Series和DataFrame类。下面简要介绍这两个类：
	Series是一种类似一维数组的对象，它由一组数据(各种Numpy数据类型)及一组与之相关的数据标签(即索引)组成。
	DataFrame是一个二维数结构，即一张表格，其中每列数据的类型相同，你可以把它看成由Series实例构成的字典
```

下面开始此次实验，我们将通过分析电信运营商的客户离散率数据集来展示Pandas的主要方法！

首先导入必要的库，即`Numpy`和`Pandas`

```python
import numpy as np
import pandas as pd
import warnings
# python开发中经常遇到报错的情况，但是warning通常并不影响程序的运行，而且有时特别讨厌,使用此方法即可
warnings.filterwarnings('ignore')
```

通过`read_csv()`方法读取数据，然后使用`head()`方法查看前五行数据！

```python
df = pd.read_csv('../数据集/telecom_churn.csv')
df.head()

"""
	df = pd.read_csv('https://labfile.oss.aliyuncs.com/courses/1283/telecom_churn.csv')
	可以直接在线解析！
"""
```

|      | State | Account length | Area code | International plan | Voice mail plan | Number vmail messages | Total day minutes | Total day calls | Total day charge | Total eve minutes | Total eve calls | Total eve charge | Total night minutes | Total night calls | Total night charge | Total intl minutes | Total intl calls | Total intl charge | Customer service calls | Churn |
| ---: | :---: | :------------: | :-------: | :----------------: | :-------------: | :-------------------: | :---------------: | :-------------: | :--------------: | :---------------: | :-------------: | :--------------: | :-----------------: | :---------------: | :----------------: | :----------------: | :--------------: | :---------------: | :--------------------: | :---: |
|    0 |  KS   |      128       |    415    |         No         |       Yes       |          25           |       265.1       |       110       |      45.07       |       197.4       |       99        |      16.78       |        244.7        |        91         |       11.01        |        10.0        |        3         |       2.70        |           1            | False |
|    1 |  OH   |      107       |    415    |         No         |       Yes       |          26           |       161.6       |       123       |      27.47       |       195.5       |       103       |      16.62       |        254.4        |        103        |       11.45        |        13.7        |        3         |       3.70        |           1            | False |
|    2 |  NJ   |      137       |    415    |         No         |       No        |           0           |       243.4       |       114       |      41.38       |       121.2       |       110       |      10.30       |        162.6        |        104        |        7.32        |        12.2        |        5         |       3.29        |           0            | False |
|    3 |  OH   |       84       |    408    |        Yes         |       No        |           0           |       299.4       |       71        |      50.90       |       61.9        |       88        |       5.26       |        196.9        |        89         |        8.86        |        6.6         |        7         |       1.78        |           2            | False |
|    4 |  OK   |       75       |    415    |        Yes         |       No        |           0           |       166.7       |       113       |      28.34       |       148.3       |       122       |      12.61       |        186.9        |        121        |        8.41        |        10.1        |        3         |       2.73        |           3            | False |

上图中每行对应一个客户，每列对应客户的一个特征！

让我们查看一下该数据库的维度、特征名称和特征类型：

`df.shape`

结果表明列表包含3333行和20列，下面我们来尝试打印列名：

`df.columns`

我们还可以使用`info()`方法输出DataFrame的一些总体信息：

`df.info()`

![](./pictures/df.info()方法.png)

`bool、int64、float64和object`是该数据库特征的数据类型。这一方法同时也会显示是否有缺失值，上述结果表明在该数据集中不存在缺失值，因为每列都包含3333个观测，和我们之前使用`shape`方法得到的数字是一样的！

`astype()`方法可以更改列的类型，下列公式将Churn离网率特征修改魏int64类型！

`df['Churn']=df['Churn'].astype('int64')`

![](./pictures/astype()方法.png)

`describe()`方法可以显示数值特征(`int64和float64`)的基本统计学特性，如未缺失值的数值、均值、标准差、范围、四分位数等！

`df.describe()`

|       | Account length |  Area code  | Number vmail messages | Total day minutes | Total day calls | Total day charge | Total eve minutes | Total eve calls | Total eve charge | Total night minutes | Total night calls | Total night charge | Total intl minutes | Total intl calls | Total intl charge | Customer service calls |    Churn    |
| :---: | :------------: | :---------: | :-------------------: | :---------------: | :-------------: | :--------------: | :---------------: | :-------------: | :--------------: | :-----------------: | :---------------: | :----------------: | :----------------: | :--------------: | :---------------: | :--------------------: | :---------: |
| count |  3333.000000   | 3333.000000 |      3333.000000      |    3333.000000    |   3333.000000   |   3333.000000    |    3333.000000    |   3333.000000   |   3333.000000    |     3333.000000     |    3333.000000    |    3333.000000     |    3333.000000     |   3333.000000    |    3333.000000    |      3333.000000       | 3333.000000 |
| mean  |   101.064806   | 437.182418  |       8.099010        |    179.775098     |   100.435644    |    30.562307     |    200.980348     |   100.114311    |    17.083540     |     200.872037      |    100.107711     |      9.039325      |     10.237294      |     4.479448     |     2.764581      |        1.562856        |  0.144914   |
|  std  |   39.822106    |  42.371290  |       13.688365       |     54.467389     |    20.069084    |     9.259435     |     50.713844     |    19.922625    |     4.310668     |      50.573847      |     19.568609     |      2.275873      |      2.791840      |     2.461214     |     0.753773      |        1.315491        |  0.352067   |
|  min  |    1.000000    | 408.000000  |       0.000000        |     0.000000      |    0.000000     |     0.000000     |     0.000000      |    0.000000     |     0.000000     |      23.200000      |     33.000000     |      1.040000      |      0.000000      |     0.000000     |     0.000000      |        0.000000        |  0.000000   |
|  25%  |   74.000000    | 408.000000  |       0.000000        |    143.700000     |    87.000000    |    24.430000     |    166.600000     |    87.000000    |    14.160000     |     167.000000      |     87.000000     |      7.520000      |      8.500000      |     3.000000     |     2.300000      |        1.000000        |  0.000000   |
|  50%  |   101.000000   | 415.000000  |       0.000000        |    179.400000     |   101.000000    |    30.500000     |    201.400000     |   100.000000    |    17.120000     |     201.200000      |    100.000000     |      9.050000      |     10.300000      |     4.000000     |     2.780000      |        1.000000        |  0.000000   |
|  75%  |   127.000000   | 510.000000  |       20.000000       |    216.400000     |   114.000000    |    36.790000     |    235.300000     |   114.000000    |    20.000000     |     235.300000      |    113.000000     |     10.590000      |     12.100000      |     6.000000     |     3.270000      |        2.000000        |  0.000000   |
|  max  |   243.000000   | 510.000000  |       51.000000       |    350.800000     |   165.000000    |    59.640000     |    363.700000     |   170.000000    |    30.910000     |     395.000000      |    175.000000     |     17.770000      |     20.000000      |    20.000000     |     5.400000      |        9.000000        |  1.000000   |

通过`include`参数显式指定包含的数据类型，可以查看非数值特征的统计数据！

`df.describe(include=['object','bool'])`

![](./pictures/describe()方法.png)

`value_counts()`方法可以查看类别(类型为object)和布尔值(类型为bool)特征。让我们看下Churn离网率的分布！

`df['churn'].value_counts()`

![](./pictures/value_counts()方法.png)

上述结果表明，在3333位用户中，2850位是忠实客户，它们的`Churn`值为0.调用`value_counts()`函数时，加上`normalize=True`参数可以显示比例！

`df['Churn'].value_counts(normalize=True)`

![](./pictures/value_counts(normalize=True).png)

> 排序

DataFrame可以根据某个变量的值(也就是列)排序。eg：根据每日消费额排序(设置ascending=False倒序排列)

`df.sort_values(by='Total day charge', ascending=False).head()`

|      | State | Account length | Area code | International plan | Voice mail plan | Number vmail messages | Total day minutes | Total day calls | Total day charge | Total eve minutes | Total eve calls | Total eve charge | Total night minutes | Total night calls | Total night charge | Total intl minutes | Total intl calls | Total intl charge | Customer service calls | Churn |
| :--: | :---: | :------------: | :-------: | :----------------: | :-------------: | :-------------------: | :---------------: | :-------------: | :--------------: | :---------------: | :-------------: | :--------------: | :-----------------: | :---------------: | :----------------: | :----------------: | :--------------: | :---------------: | :--------------------: | :---: |
| 365  |  CO   |      154       |    415    |         No         |       No        |           0           |       350.8       |       75        |      59.64       |       216.5       |       94        |      18.40       |        253.9        |        100        |       11.43        |        10.1        |        9         |       2.73        |           1            |   1   |
| 985  |  NY   |       64       |    415    |        Yes         |       No        |           0           |       346.8       |       55        |      58.96       |       249.5       |       79        |      21.21       |        275.4        |        102        |       12.39        |        13.3        |        9         |       3.59        |           1            |   1   |
| 2594 |  OH   |      115       |    510    |        Yes         |       No        |           0           |       345.3       |       81        |      58.70       |       203.4       |       106       |      17.29       |        217.5        |        107        |        9.79        |        11.8        |        8         |       3.19        |           1            |   1   |
| 156  |  OH   |       83       |    415    |         No         |       No        |           0           |       337.4       |       120       |      57.36       |       227.4       |       116       |      19.33       |        153.9        |        114        |        6.93        |        15.8        |        7         |       4.27        |           0            |   1   |
| 605  |  MO   |      112       |    415    |         No         |       No        |           0           |       335.5       |       77        |      57.04       |       212.5       |       109       |      18.06       |        265.0        |        132        |       11.93        |        12.7        |        8         |       3.43        |           2            |   1   |

此外，还可以根据多个列的数值排序。下面函数实现的功能为：先按 Churn 离网率 升序排列，再按 `Total day charge` 每日总话费 降序排列，优先级 `Churn > Tatal day charge`。

`df.sort_values(by=['Churn','Total day charge'],ascending=[True,False]).head()`

|      | State | Account length | Area code | International plan | Voice mail plan | Number vmail messages | Total day minutes | Total day calls | Total day charge | Total eve minutes | Total eve calls | Total eve charge | Total night minutes | Total night calls | Total night charge | Total intl minutes | Total intl calls | Total intl charge | Customer service calls | Churn |
| :--: | :---: | :------------: | :-------: | :----------------: | :-------------: | --------------------: | :---------------: | :-------------: | :--------------: | :---------------: | :-------------: | :--------------: | :-----------------: | :---------------: | :----------------: | :----------------: | :--------------: | :---------------: | :--------------------: | :---: |
| 688  |  MN   |       13       |    510    |         No         |       Yes       |                    21 |       315.6       |       105       |      53.65       |       208.9       |       71        |      17.76       |        260.1        |        123        |       11.70        |        12.1        |        3         |       3.27        |           3            |   0   |
| 2259 |  NC   |      210       |    415    |         No         |       Yes       |                    31 |       313.8       |       87        |      53.35       |       147.7       |       103       |      12.55       |        192.7        |        97         |        8.67        |        10.1        |        7         |       2.73        |           3            |   0   |
| 534  |  LA   |       67       |    510    |         No         |       No        |                     0 |       310.4       |       97        |      52.77       |       66.5        |       123       |       5.65       |        246.5        |        99         |       11.09        |        9.2         |        10        |       2.48        |           4            |   0   |
| 575  |  SD   |      114       |    415    |         No         |       Yes       |                    36 |       309.9       |       90        |      52.68       |       200.3       |       89        |      17.03       |        183.5        |        105        |        8.26        |        14.2        |        2         |       3.83        |           1            |   0   |
| 2858 |  AL   |      141       |    510    |         No         |       Yes       |                    28 |       308.0       |       123       |      52.36       |       247.8       |       128       |      21.06       |        152.9        |        103        |        6.88        |        7.4         |        3         |       2.00        |           1            |   0   |

